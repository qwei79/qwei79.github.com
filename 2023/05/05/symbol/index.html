<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="一个刘庆伟用来写博客的地方"><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>独一无二的 Symbol，到底怎么用？</title><link rel="shortcut icon" href="/images/avatar.png" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.2"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.png"></div><div class="author"><div class="author-name"><a href="/">刘庆伟的日志中心</a></div><div class="about-me">一个渣渣前端切图仔用来写日志的地方</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">归档</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.png"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/qwei79"></span><a href="https://github.com/qwei79" target="_blank" title="https://github.com/qwei79">https://github.com/qwei79</a></li><li class="social-item"><span class="label"><img src="/images/socials/email.svg" alt="qwei@msn.com"></span><span>qwei@msn.com</span></li><li class="social-item"><span class="label"><img src="/images/socials/wechat.svg" alt="liuqw579"></span><span>liuqw579</span></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">独一无二的 Symbol，到底怎么用？</div><div class="date">写于2023年05月05日</div><div class="content"><p>ES6 的 Symbol 是一种新的 JavaScript 数据类型，它是原始数据类型，专门用来表示独一无二的值。Symbol 是 ES6 针对 JavaScript 缺陷的一种解决方案，用来解决属性名冲突、对象私有属性、对象迭代器等问题。</p>
<p>Symbol 的基本语法是这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sym = <span class="title class_">Symbol</span>(<span class="string">&quot;description&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>这其中，描述符是一个可选的字符串，用于调试和检查。Symbol 主要有三个特点：</p>
<ol>
<li>每个Symbol值都是唯一的，这意味着没有两个不同的Symbol值会相等，即使它们看起来一样也是如此。</li>
<li>Symbol值不会自动转换为字符串或数字，它们可以被用作对象属性的键。</li>
<li>Symbol值是不可变的，这意味着一旦创建了一个Symbol，它的属性是不可修改的。</li>
</ol>
<p>首先，我们需要了解一下 JavaScript 中对象属性的默认特性：可见。如果多个模块定义了同名的属性，就会发生冲突。这时就可以使用 Symbol 提供唯一性的保证，防止属性名冲突。在使用 Symbol 时，不同的属性名不会相等，因此可以防止属性名冲突的问题。下面来看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> id1 = <span class="title class_">Symbol</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> id2 = <span class="title class_">Symbol</span>(<span class="string">&#x27;id&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(id1 === id2); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>两个 Symbol 类型的变量 id1 和 id2 的描述符都是 ‘id’，但它们不相等，因为它们是独立的值，具有唯一性。</p>
<p>我们来用一个简单的例子，看一下 Symbol 的一些使用场景，比如如何实现对象私有属性。JavaScript 并没有提供一种私有属性的语法，而是通过给属性名加上一个唯一的 Symbol 来实现。这样，属性名由 Symbol 组成，从而无法从外部访问，保证了属性的私有性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  [<span class="title class_">Symbol</span>(<span class="string">&#x27;name&#x27;</span>)]: <span class="string">&#x27;Tom&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">name</span>); <span class="comment">// undefined</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;&#125;;</span><br><span class="line"><span class="keyword">const</span> name = <span class="title class_">Symbol</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">obj2[name] = <span class="string">&quot;Tom&quot;</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj2[name]); <span class="comment">// &quot;Tom&quot;</span></span><br></pre></td></tr></table></figure>
<p>我们在对象 obj 中使用了 Symbol 实例作为属性名，该属性名由 Symbol 类型的变量 ‘name’ 组成，从而保证了该属性的私有性。</p>
<p>除了提供唯一性的保证和实现私有属性的功能，Symbol 也可以用于实现对象的迭代器，以及在全局注册表中检索和注册 Symbol。这些功能需要详细了解，才能进行灵活的应用。</p>
<p>比如说迭代器，在 ES6 中，要想将对象用于循环迭代，需要定义一个迭代器对象，并将其赋给 Symbol.iterator 属性。可以这样来写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  [<span class="title class_">Symbol</span>.<span class="property">iterator</span>]() &#123;</span><br><span class="line">    <span class="keyword">const</span> items = [<span class="string">&#x27;apple&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>, <span class="string">&#x27;cherry&#x27;</span>];</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span>;</span><br><span class="line">     <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="title function_">next</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">value</span>: items[index++],</span><br><span class="line">          <span class="attr">done</span>: index &gt; items.<span class="property">length</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(item);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// apple</span></span><br><span class="line"><span class="comment">// banana</span></span><br><span class="line"><span class="comment">// cherry</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们定义了一个对象  <code>obj</code> ，并且将一个迭代器对象赋给  <code>Symbol.iterator</code>  属性。这样， <code>obj</code>  就可以用于 for…of 循环，实现了对象的迭代功能。当然，还可以这样写：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> myIterable = &#123;&#125;;</span><br><span class="line">myIterable[<span class="title class_">Symbol</span>.<span class="property">iterator</span>] = <span class="keyword">function</span>* () &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> value <span class="keyword">of</span> myIterable) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3</span></span><br></pre></td></tr></table></figure>

<p>上面还提到了再全局注册表中检索和注册 Symbol，那么怎么做呢？</p>
<p>在 JavaScript 中，Symbol.for() 和 Symbol.keyFor() 分别用于在全局注册表中检索和注册 Symbol。Symbol.for() 在全局注册表中搜索具有相同描述符的 Symbol，如果存在，则返回该 Symbol；否则，会新建一个具有相同描述符的 Symbol 并返回。而 Symbol.keyFor() 则根据 Symbol 返回其描述符。这两个方法可以用来确保只有一个 Symbol 实例存在。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> firstName = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;firstName&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> lastName = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;lastName&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(firstName === lastName); <span class="comment">// false</span></span><br><span class="line"><span class="keyword">const</span> firstName2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;firstName&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> lastName2 = <span class="title class_">Symbol</span>.<span class="title function_">for</span>(<span class="string">&#x27;lastName&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(firstName === firstName2); <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(firstName)); <span class="comment">// firstName</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Symbol</span>.<span class="title function_">keyFor</span>(<span class="title class_">Symbol</span>.<span class="property">iterator</span>)); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>在这个例子中，我们使用 Symbol.for() 方法创建了两个 Symbol 实例，它们的描述符都是 ‘firstName’。由于它们描述符相同，因此它们是相等的，返回值为 true。</p>
<p>由于 Symbol 具有唯一性，我们可以使用 Symbol.for() 确保只有一个 Symbol 实例存在，从而保证程序的正确性。</p>
<p>需要注意的是，使用 Symbol.for() 在全局注册表中注册 Symbol 可以使其被多个模块共享，而使用 Symbol() 创建的 Symbol 仅在当前模块中有效。此外，Symbol.for() 会在全局注册表中缓存每个 Symbol 实例，因此应该避免滥用此方法，以免产生内存泄漏。</p>
</div><div class="tags"></div></section></div><div class="container"><ul class="nav"><li>下一篇：<a href="/2023/04/28/reacthook/">React Hooks 全方位解析</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><span>Powered by </span><a href="http://hexo.io" target="_blank">Hexo</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" target="_blank">Bear</a><span>.</span></div></footer>
<script src="/script/jquery.min.js"></script>

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script src="/script/index.js"></script>

<script src="/script/post.js"></script>
</body></html>