<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="description" content="一个刘庆伟用来写博客的地方"><meta name="keyword"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Socket.IO 入门指南：实时通信应用程序开发</title><link rel="shortcut icon" href="/images/avatar.png" type="image/x-icon"><link href="/styles/site.css" rel="stylesheet"><meta name="generator" content="Hexo 5.4.2"></head><body><header class="container" id="header"><div class="header"><div class="header-left"><div class="avatar"><img src="/images/avatar.png"></div><div class="author"><div class="author-name"><a href="/">刘庆伟的日志中心</a></div><div class="about-me">一个渣渣前端切图仔用来写日志的地方</div></div></div><div class="header-right"><ul class="navigation"><li><a href="/archives">归档</a></li></ul></div><div class="about-me-mask"><div class="about-me-wrap"><div class="about-me__header"><div class="avatar"><img src="/images/avatar.png"></div></div><ul class="socials"><li class="social-item"><span class="label"><img src="/images/socials/github.svg" alt="https://github.com/qwei79"></span><a href="https://github.com/qwei79" target="_blank" title="https://github.com/qwei79">https://github.com/qwei79</a></li><li class="social-item"><span class="label"><img src="/images/socials/email.svg" alt="qwei@msn.com"></span><span>qwei@msn.com</span></li><li class="social-item"><span class="label"><img src="/images/socials/wechat.svg" alt="liuqw579"></span><span>liuqw579</span></li></ul></div></div></div></header><div class="container post"><section class="article"><div class="title">Socket.IO 入门指南：实时通信应用程序开发</div><div class="date">写于2023年05月16日</div><div class="content"><p>Socket.IO 是一个基于 Node.js 的实时应用程序框架，它允许实时、双向和事件性通信。它包含一个客户端库和一个服务器库，并在不同的传输协议之间具有自动降级的能力。Socket.IO 提供了可靠性和实时性，被广泛用于聊天应用程序、实时游戏和协作编辑等在线应用。</p>
<h2 id="一、安装"><a href="#一、安装" class="headerlink" title="一、安装"></a>一、安装</h2><p>要使用 Socket.IO，你需要在服务器端和客户端分别安装 Socket.IO 库。在服务器端，可以使用 npm 安装 Socket.IO：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install socket.io</span><br></pre></td></tr></table></figure>
<p>在客户端，可以使用 Script 标签加载 Socket.IO 库：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/socket.io/socket.io.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="二、建立连接"><a href="#二、建立连接" class="headerlink" title="二、建立连接"></a>二、建立连接</h2><p>Socket.IO 在服务器和客户端之间建立一个 WebSocket 连接，这样就可以实时地发送和接收数据。下面是一个简单的服务器端代码，用来监听客户端连接：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">&quot;socket.io&quot;</span>)(server);</span><br><span class="line"></span><br><span class="line">io.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;A client connected&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在客户端，可以使用 <code>io</code> 对象来连接服务器：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> socket = <span class="title function_">io</span>(<span class="string">&quot;http://localhost:3000&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>将 <code>http://localhost:3000</code> 替换为你的服务器地址和端口号。<br>如果连接成功，会触发 <code>connect</code> 事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">socket.<span class="title function_">on</span>(<span class="string">&quot;connect&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Connected to server&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="三、发送和接收数据"><a href="#三、发送和接收数据" class="headerlink" title="三、发送和接收数据"></a>三、发送和接收数据</h2><p>Socket.IO 在服务器和客户端之间的通信是通过事件(event)来进行的。可以使用 <code>socket.emit()</code> 方法发送一个事件，使用 <code>socket.on()</code> 方法监听一个事件。<br>服务器端：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">io.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  socket.<span class="title function_">emit</span>(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Welcome to the chat room&quot;</span>);</span><br><span class="line"></span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&quot;chat&quot;</span>, <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">    io.<span class="title function_">emit</span>(<span class="string">&quot;chat&quot;</span>, message);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>客户端：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">socket.<span class="title function_">on</span>(<span class="string">&quot;message&quot;</span>, <span class="function">(<span class="params">message</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> messageInput = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#message-input&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> sendButton = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&quot;#send-button&quot;</span>);</span><br><span class="line"></span><br><span class="line">sendButton.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> message = messageInput.<span class="property">value</span>;</span><br><span class="line">  socket.<span class="title function_">emit</span>(<span class="string">&quot;chat&quot;</span>, message);</span><br><span class="line">  messageInput.<span class="property">value</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在上面的代码中，当客户端连接到服务器时，服务器会向客户端发送一个 <code>message</code> 事件，并在客户端上显示欢迎消息。<br>当用户输入一条消息并点击发送按钮时，客户端会发送一个 <code>chat</code> 事件到服务器，并且服务器会将这条消息广播给所有连接到服务器的客户端。同时，客户端通过监听 <code>chat</code> 事件来接收服务器发来的消息，并在页面上显示。</p>
<h2 id="四、断开连接"><a href="#四、断开连接" class="headerlink" title="四、断开连接"></a>四、断开连接</h2><p>当客户端不再需要连接服务端时，应该关闭这个连接。可以使用 <code>socket.disconnect()</code> 方法，在客户端关闭连接：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socket.<span class="title function_">disconnect</span>();</span><br></pre></td></tr></table></figure>
<p>在服务器端，可以监听到 <code>disconnect</code> 事件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">io.<span class="title function_">on</span>(<span class="string">&quot;connection&quot;</span>, <span class="function">(<span class="params">socket</span>) =&gt;</span> &#123;</span><br><span class="line">  socket.<span class="title function_">on</span>(<span class="string">&quot;disconnect&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;A client disconnected&quot;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在这个事件处理程序中，可以进行一些必要的清理操作，例如从在线用户列表中移除该用户，或者取消对该用户的监听等。</p>
<p>Socket.IO还提供了许多丰富的功能，例如房间（rooms）、命名空间（namespace）、广播（broadcasting）、Acknowledgements等，这些功能，就等待大家自己来探索了。</p>
</div><div class="tags"></div></section></div><div class="container"><ul class="nav"><li>下一篇：<a href="/2023/05/12/pure-function/">纯函数：为什么它们是函数式编程的基石？</a></li></ul></div><div id="backToTop"><div class="back-arrow back-arrow-left"></div><div class="back-arrow back-arrow-right"></div></div><footer class="container"><div class="rights"><span>Powered by </span><a href="http://hexo.io" target="_blank">Hexo</a><span>, Theme </span><a href="https://github.com/gary-Shen/hexo-theme-bear" target="_blank">Bear</a><span>.</span></div></footer>
<script src="/script/jquery.min.js"></script>

<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

<script src="/fancybox/jquery.fancybox.pack.js"></script>

<script src="/script/index.js"></script>

<script src="/script/post.js"></script>
</body></html>